{
  "$id": "https://example.local/schemas/block.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Block",
  "type": "object",
  "additionalProperties": false,
  "$comment": "Hierarchy fields (parent/child relationships, restart grouping) now live in relationships.json.",
  "required": [
    "id",
    "content_hash",
    "type",
    "section_id",
    "style",
    "text"
  ],
  "properties": {
    "id": {
      "description": "Unique block ID. Matched to document paragraphs via native w14:paraId attribute.",
      "type": "string",
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "content_hash": {
      "description": "Deterministic hash of the block's normalized text; duplicate hashes use an appended '#<n>' suffix.",
      "type": "string",
      "pattern": "^sha256:[0-9a-f]{64}(#[0-9]+)?$"
    },
    "type": {
      "type": "string",
      "enum": [
        "heading",
        "paragraph",
        "list_item",
        "table_cell",
        "image_caption"
      ]
    },
    "level": {
      "type": [
        "integer",
        "null"
      ],
      "minimum": 1,
      "maximum": 6
    },
    "section_id": {
      "type": "string",
      "description": "UUID of the owning section",
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "style": {
      "type": "string"
    },
    "style_id": {
      "type": "string"
    },
    "para_id": {
      "type": "string"
    },
    "para_idx": {
      "type": "integer",
      "minimum": 0
    },
    "num_pr": {
      "type": ["object", "null"],
      "additionalProperties": false,
      "properties": {
        "numId": { "anyOf": [ { "type": "integer" }, { "type": "string" } ] },
        "ilvl": { "anyOf": [ { "type": "integer" }, { "type": "string" } ] },
        "numRestart": { "type": "boolean" }
      }
    },
    "text": {
      "type": "string"
    },
    "list": {
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": false,
      "required": [
        "num_id",
        "abstract_num_id",
        "level",
        "counters",
        "ordinal",
        "format",
        "pattern",
        "is_legal",
        "restart_boundary",
        "list_instance_id",
        "numbering_digest",
        "ordinal_at_parse"
      ],
      "properties": {
        "num_id": {
          "description": "Word numbering instance identifier (w:num/@w:numId).",
          "anyOf": [
            {
              "type": "integer",
              "minimum": 0
            },
            {
              "type": "string",
              "pattern": "^[0-9]+$"
            }
          ]
        },
        "abstract_num_id": {
          "description": "Abstract numbering template identifier (w:abstractNum/@w:abstractNumId).",
          "anyOf": [
            {
              "type": "integer",
              "minimum": 0
            },
            {
              "type": "string",
              "pattern": "^[0-9]+$"
            },
            {
              "type": "null"
            }
          ]
        },
        "level": {
          "description": "Zero-based list level (w:ilvl).",
          "type": "integer",
          "minimum": 0
        },
        "counters": {
          "description": "Per-level counter path used to render ordinals (1-indexed).",
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "integer",
            "minimum": 1
          }
        },
        "ordinal": {
          "description": "Rendered numbering label (e.g., '2.1(a)').",
          "type": "string"
        },
        "format": {
          "description": "Word numbering format (w:numFmt/@w:val).",
          "type": "string",
          "minLength": 1
        },
        "pattern": {
          "description": "Level text pattern (w:lvlText/@w:val).",
          "type": "string"
        },
        "is_legal": {
          "description": "True when Word requests legal-style numbering (w:isLgl).",
          "type": "boolean"
        },
        "restart_boundary": {
          "description": "True when numbering restarts because of overrides.",
          "type": "boolean"
        },
        "list_instance_id": {
          "description": "Stable identifier for this numbering instance across re-parses.",
          "type": "string",
          "pattern": "^listinst-[0-9a-f]{40}$"
        },
        "numbering_digest": {
          "description": "Hash of numbering schema (numId, level, numFmt, lvlText).",
          "type": "string",
          "pattern": "^num-[0-9a-f]{40}$"
        },
        "ordinal_at_parse": {
          "description": "Flat ordinal at analysis time (for drift reporting).",
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "table": {
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": false,
      "required": [
        "table_id",
        "row",
        "col"
      ],
      "properties": {
        "table_id": {
          "type": "string"
        },
        "row": {
          "type": "integer",
          "minimum": 0
        },
        "col": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "attachment_id": {
      "description": "Identifier of the attachment container the block belongs to, when applicable.",
      "type": [
        "string",
        "null"
      ],
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "attachment": {
      "description": "Attachment metadata for anchor blocks.",
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": false,
      "required": [
        "attachment_id",
        "block_id",
        "type"
      ],
      "properties": {
        "attachment_id": {
          "type": "string",
          "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
        },
        "block_id": {
          "type": "string",
          "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
        },
        "type": {
          "type": "string",
          "enum": ["schedule", "annex", "appendix", "exhibit", "attachment", "other"]
        },
        "ordinal": {
          "type": [
            "string",
            "null"
          ]
        },
        "title": {
          "type": [
            "string",
            "null"
          ]
        },
        "parent_attachment_id": {
          "type": [
            "string",
            "null"
          ],
          "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
        }
      }
    },
    "anchor": {
      "description": "Optional content/position hints to help reconcile after reflow.",
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": false,
      "properties": {
        "text_hash": {
          "type": "string",
          "pattern": "^sha256:[0-9a-f]{64}$"
        },
        "context_before": {
          "type": [
            "string",
            "null"
          ],
          "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
        },
        "context_after": {
          "type": [
            "string",
            "null"
          ],
          "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
        },
        "style_sig": {
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "metadata": {
      "description": "Optional enrichment fields from labeling/classification.",
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": false,
      "properties": {
        "topics": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "category": {
          "type": "string"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "summary": {
          "type": "string"
        }
      }
    },
    "role": {
      "description": "Optional semantic role classification for the block.",
      "anyOf": [
        {
          "type": "string",
          "enum": [
            "drafting_note"
          ]
        },
        {
          "type": "null"
        }
      ]
    },
    "definition": {
      "description": "Definition grouping metadata when the block participates in a definition.",
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": false,
      "required": [
        "definition_id",
        "role"
      ],
      "properties": {
        "definition_id": {
          "type": "string",
          "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
        },
        "role": {
          "type": "string",
          "enum": [
            "term",
            "body"
          ]
        },
        "term": {
          "type": [
            "string",
            "null"
          ]
        },
        "inline_definition": {
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "indent": {
      "description": "Paragraph indentation metadata (twips).",
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": false,
      "properties": {
        "left": { "type": "integer" },
        "hanging": { "type": "integer" },
        "first_line": { "type": "integer" }
      }
    },
    "continuation_of": {
      "type": ["string", "null"],
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "clause_group_id": {
      "type": ["string", "null"],
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-4[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}$"
    },
    "heading": {
      "description": "Heading metadata when the block represents a clause heading.",
      "type": [
        "object",
        "null"
      ],
      "additionalProperties": false,
      "required": [
        "text",
        "source"
      ],
      "properties": {
        "text": {
          "type": "string"
        },
        "source": {
          "type": "string",
          "enum": [
            "explicit",
            "toc_synthesized",
            "none"
          ]
        },
        "fallback_label": {
          "type": [
            "string",
            "null"
          ]
        }
      }
    },
    "page_break_before": {
      "description": "True if this paragraph has a page break before it (explicit or from Word's lastRenderedPageBreak).",
      "type": [
        "boolean",
        "null"
      ]
    },
    "page_break_after": {
      "description": "True if this paragraph contains an explicit hard page break.",
      "type": [
        "boolean",
        "null"
      ]
    }
  }
}
